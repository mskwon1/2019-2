### Branch Instructions

![image-20191106153855035](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20191106153855035.png)

- BL : Branch with link(PC값을 LR에 저장하고 branch)
- cond : 조건부 실행
- expression : 코드의 위치를 변수같은 형태로 저장해놓은 것

![image-20191106155733618](C:\Users\user\AppData\Roaming\Typora\typora-user-images\image-20191106155733618.png)

- Destination address calculation
  - Bits [23:0] are used as offset using PC as the basis
  - Offset calculation
    - MSB is the sign bit (+ or -)
    - The remaining 23 bits are used as offset with 2 bits left shift operation
    - 16 MB의 range -> 부호비트 빼면 8 MB range
    - Word addressing의 관점으로 접근하면 32MB range(하위 2비트는 무조건 0인것을 이용)

#### 실습

~~~assembly
		mov		r0, #1		; 0x00
		add		r1, r0, r0	; 0x04
		bl		func		; 0x08
		add		r1, r0, r0	; 0x0C
		sub		r1, r0, r0	; 0x10
loop	b		loop		; 0x14
func	add		r1, r0, r0	; 0x18
		mov		pc, lr		; 0x1C
~~~

- 파이프라인 구조때문에 execution line 기준으로 fetch는 2라인 뒤, decode는 1라인 뒤에서 이루어지고 있다

- bl 실행시 돌아와서 다음으로 실행할 pc값을 lr에 저장
  - 브랜치 명령 실행시 파이프라인이 한번 깨짐

### Subroutines

- Branch and Link (BL) instruction is used
  - Stores the next address into LR
  - LR <= PC - 4  : 파이프라이닝 때문에 현재 PC는 2칸앞에 있기때문에 -4 해주는 것
- Returning from subroutine
  - `MOV pc, lr`